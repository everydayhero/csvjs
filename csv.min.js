// ==========================================================================
// Project:   CSV.js
// Copyright: Â©2013 Marty Zalega and Everyday Hero
// License:   Licensed under MIT license
//            See https://raw.github.com/everydayhero/csvjs/master/LICENSE
// ==========================================================================

(function(n,p){"function"!==typeof RegExp.escape&&(RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});var q=function(){for(var a=Array.prototype.slice.call(arguments),b=a.shift(),c,e;c=a.shift();)for(e in c)c.hasOwnProperty(e)&&(b[e]=c[e]);return b},g=function(a,b){var c;if("function"===typeof a.forEach)a.forEach(b);else for(c in a)if(a.hasOwnProperty(c)&&!1===b(a[c],c,a))break},f=function(a){this.opts=q({},h.defaults,a);this.headerRow=null};f.prototype={constructor:f,convert:function(a){var b=
this,c=a;b.converters||(b.converters={},g(h.converters,function(a,c){b.converters[c]={re:RegExp(c),func:a}}));g(this.converters,function(b){if(b.re.test(a))return c=b.func(a),!1});return c},mapProperties:function(a){this.headerRow&&g(this.headerRow,function(b,c){"undefined"===typeof a[b]&&(a[b]=a[c])})},parse:function(a){var b=this,c=this.opts,e=RegExp.escape(c.colSep),f=RegExp.escape(c.rowSep),h=RegExp(["(?=",e,")"].join(""),"g"),l=RegExp(["(?=",f,")"].join(""),"g"),j=RegExp.escape(c.quoteChar),
r=RegExp(["^\\s*",j,"([^",j,"]*)",j,"\\s*$"].join("")),s=RegExp("^("+[e,f].join("|")+")"),t=RegExp(j+j,"g");a=a.split(l);var m=[],d=null,k=[];g(a,function(a){a=a.split(h);g(a,function(a){d=[d,a].join("");0===(d.split(c.quoteChar).length-1)%2&&(d=d.replace(s,""),(a=d.match(r))&&(d=a[1]),d=d.replace(t,c.quoteChar),c.fieldSizeLimit&&(d=d.substr(0,c.fieldSizeLimit)),k.push(b.convert(d)),d=null)});if(null===d){if(!(a=!c.skipBlanks))a=k,a=a.filter(function(a){return!!a}),a=!!a.length;a&&(!c.headers||b.headerRow?
(c.headers&&b.mapProperties(k),m.push(k)):b.headerRow=k);k=[]}});if(null!==d)throw"Malformed CSV data";m.headers=this.headerRow;return m},stringify:function(a){var b=this.opts,c=[],e=RegExp.escape(b.quoteChar),f=RegExp.escape(b.colSep),h=RegExp.escape(b.rowSep),l=RegExp(e,"g"),j=RegExp("("+[e,f,h].join("|")+")");g(a,function(a){var e=[];g(a,function(a){a=a.toString();b.fieldSizeLimit&&(a=a.substr(0,b.fieldSizeLimit));a=a.replace(l,b.quoteChar+b.quoteChar);if(b.forceQuotes||j.test(a))a=[b.quoteChar,
a,b.quoteChar].join("");e.push(a)});c.push(e.join(b.colSep))});return c.join(b.rowSep)}};var h={VERSION:p,defaults:{colSep:",",rowSep:"\n",quoteChar:'"',fieldSizeLimit:null,headers:!1,skipBlanks:!1,forceQuotes:!1},converters:{"\\d":function(a){return-1!==a.indexOf(".")?parseFloat(a):parseInt(a)},"(true|TRUE|false|FALSE)":function(a){return"true"===a.toLowerCase()},"^(\\s*|NULL)$":function(){return null}},parse:function(a,b){return(new f(b)).parse(a)},stringify:function(a,b){return(new f(b)).stringify(a)}};
n.CSV=h})(window,"0.0.1");
